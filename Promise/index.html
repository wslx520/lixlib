<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<title>Promise原理及实现</title>
</head>
<body>
	
</body>
<script src="promise.js"></script>
<script>
function doubleUp(value) {
	var retPromise = new Promise(function (resolve, reject) {
       // reject(new Error("this promise is rejected"));
       resolve(value * 2)
    });
    return retPromise;
 // return ;
}
function increment(value) {
 return value + 1;
}
function output(value) {
 console.log(value);// => (1 + 1) * 2
}
var promise = Promise.resolve(1);
promise
 .then(increment)
 // dobleUp 返回了一个promise, 原生Promise正常执行，但自实现的Promise就出问题了
 .then(doubleUp)
 .then(output)
 .fail(function(error){
 // promise chain中出现异常的时候会被调用
 console.error(error);
 });
    var a = 100;
	var pm = new Promise(function aa (resolve, reject) {
        if(a<1000) {
            reject('太小了')
        } else {
            setTimeout(function () {
                resolve(a);
            },1000)
        }
    });
    console.log(pm)
    pm.then(function (val) {
        console.log(val);
    }).fail(function (ee) {
        console.log(ee)
    });
    console.log(11111111111)
    var p1 = new Promise(function(resolve, reject) { 
	  setTimeout(resolve, 1000, "one"); 
	}); 
	var p2 = new Promise(function(resolve, reject) { 
	  setTimeout(resolve, 2000, "two"); 
	});
	var p3 = new Promise(function(resolve, reject) {
	  setTimeout(resolve, 3000, "three");
	});
	var p4 = new Promise(function(resolve, reject) {
	  setTimeout(resolve, 4000, "four");
	});
	var p5 = new Promise(function(resolve, reject) {
	  reject("reject");
	});
    Promise.all([p1,p2,p3,p4,p5]).then(function (list) {
    	console.log(list);
    }).fail(function (err) {
    	console.log(err,'err')
    })
    Promise.race([p1,p2,p3,p4]).then(function (list) {
    	console.log(list);
    })
</script>
</html>
